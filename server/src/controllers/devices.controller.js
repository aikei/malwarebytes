
const db = require('../services/db');
const { server } = require('../services/ws');
const log = require('../log/log');

module.exports = {
  async getAll(req, res, next) {
    const devices = await db.getDevices();
    res.json(devices);
  },
  async updateCart(req, res, next) {
    log.trace('updateCart req body: ', req.body);
    await db.updateCart({
      cart: req.body.cart,
      username: 'user1'
    });
    server.io.emit("cartUpdated", {
      cart: req.body.cart,
      id: req.body.id
    });
    res.send('OK');
  },
  async changeQuantity(req, res, next) {
    log.trace('changeQuantity req body: ', req.body);
    const resp = await db.changeQuantity(req.body);
    server.io.emit("quantityUpdated", {
      device: { ...resp, id: req.body.deviceId },
      changeBy: req.body.changeBy,
      id: req.get('Authorization')
    });
    res.send('OK');
  },
  async getCart(req, res, next) {
    const cart = await db.getCart({ username: 'user1' });
    res.json(cart);
  }
}